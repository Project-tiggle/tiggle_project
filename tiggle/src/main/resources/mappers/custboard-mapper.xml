<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="custBoardMapper">

	<resultMap id="resultCustBoard" type="CustBoard">
	       <result property="uuid" column="UUID" />
	       <result property="cId" column="C_ID" />
	       <result property="cCategory" column="C_CATEGORY" />
	       <result property="title" column="TITLE" />
	       <result property="cContent" column="C_CONTENT" />
	       <result property="createdAt" column="CREATED_AT" />
	       <result property="updatedAt" column="UPDATED_AT" />
	       <result property="updatedYn" column="UPDATED_YN" />
	       <result property="deletedAt" column="DELETED_AT" />
	       <result property="deleteYn" column="DELETED_YN" />
	       <result property="cLev" column="C_LEVEL" />
	       <result property="refNo" column="REFNO" />
	       <result property="fileUrl" column="FILE_URL" />
	       <result property="id" column="ID" />
	</resultMap>
	
	<!-- 관리자용 보드 리스트 총갯수 조회용 -->
	<select id="selectCustListCount" resultType="_int">
		select count(*)
		from tb_cust_board
	</select>
	
	<!-- 관리자용 보드 리스트 조회용 -->
	<select id="selectCustList" parameterType="Paging" resultMap="resultCustBoard">
		select *
		from (
				select rownum rnum, tb.*
			    from (
			    		select uuid, c_id, c_category, title, c_content, created_at,
			            		cb.updated_at as updated_at, updated_yn,
			            		cb.deleted_at as deleted_at, cb.deleted_yn as deleted_yn,
			            		c_level, refno, file_url, id
        				from tb_cust_board cb
				        join tb_member using (uuid)
				        order by updated_yn asc, refno desc, c_level asc
			         ) tb
		     )
		where rnum between #{ startRow } and #{ endRow }
	</select>
	
	<!-- 관리자용 cId로 정보 조회해 오기용 -->
	<select id="selectCboardCid" parameterType="_int" resultMap="resultCustBoard">
		select *
		from tb_cust_board
		join tb_member using (uuid)
		where c_id = #{ cId }
	</select>
	
	<insert id="insertReply" parameterType="CustBoard">
		insert into tb_cust_board
		values (#{ uuid }, (select max(cid) +1 from tb_cust_board), #{ cCategory },
				#{ title }, #{ cContent }, sysdate, null, null, null, Y, #{ cLev },
				#{ refNo }, #{ fileUrl })
	</insert>
	
</mapper>
