<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="reviewMapper">
<!-- namespace (이름공간) == 패키지와 같음 : 매퍼 영역에 이름을 부여준 것으로 이해하면 됨 -->
	<resultMap type="Review" id="resultReview">
			<result property="totalId" column="TOTAL_ID" />
			<result property="uuid" column="UUID" />
			<result property="rNum" column="R_NUM" />
			<result property="nickName" column="NICKNAME" />
			<result property="rContents" column="R_CONTENTS" />
			<result property="writeDate" column="WRITE_DATE" />
			<result property="updateDate" column="UPDATE_DATE" />
			<result property="updateYN" column="UPDATE_YN" />
			<result property="deleteDate" column="DELETE_DATE" />
			<result property="deleteDYN" column="DELETE_YN" />
	</resultMap>
	
	
	

	<!-- ajax 테스트용 : 최근 등록된 마지막 공지글 한 개 조회용 -->
	<select id="selectLast" resultMap="resultNotice">
		select * from TB_REVIEW
		where reviewno = (select max(reviewno) from notice)
	</select>
		
	
	<select id="selectReview" parameterType="_int" resultMap="resultReview">
		select * from TB_REVIEW
		where R_NUM = #{ no }
	</select>
	
	
	
	<select id="selectList" resultMap="resultNotice" parameterType="Paging">
		select *
		from (select TOTAL_ID, R_NUM, UUID, NICKNAME, R_CONTENTS, WRITE_DATE, UPDATE_DATE, 
            UPDATE_YN, DELETE_DATE, DELETE_YN
        from (select * from notice
                order by write_date desc, R_NUM desc))
		where rnum between #{ startRow } and #{ endRow }
	</select>
	
	
	
	<!-- dml -->
	
	<!-- 새 한줄평 등록용 쿼리 -->
	<insert id="insertReview" parameterType="Review">
		insert into TB_REVIEW
			values ((select max(noticeno) + 1 from TB_REVIEW ),
				#{ noticeTitle }, sysdate, #{ noticeWriter }, #{ noticeContent },
				#{ originalFilePath}, #{ renameFilePath }, #{ importance }, #{ impEndDate }, default )
	</insert>
	
	<!-- 공지글 삭제용 쿼리 -->
	<delete id="deleteNotice">
		delete from notice where noticeno = #{ no }
	</delete>
	
	<!-- 공지글 수정용 쿼리 -->
	<update id="updateNotice" parameterType="Notice">
		update notice
		<if test="originalFilePath == null">
			set	noticetitle = #{ noticeTitle }, noticewriter = #{ noticeWriter },
			noticecontent = #{ noticeContent }, noticedate = sysdate,
			original_filepath = null, rename_filepath = null,
			importance = #{ importance }, imp_end_date = #{ impEndDate }			
		</if>
		<if test="originalFilePath != null">
			set	noticetitle = #{ noticeTitle }, noticewriter = #{ noticeWriter },
			noticecontent = #{ noticeContent }, noticedate = sysdate,
			original_filepath = #{ originalFilePath }, rename_filepath = #{ renameFilePath },
			importance = #{ importance }, imp_end_date = #{ impEndDate }
		</if>
		where noticeno = #{ noticeNo }
	</update>
	


	
	
</mapper>








